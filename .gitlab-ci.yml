image: docker:latest

cache:
  paths:
    - .m2/repository

stages:
  - docker_build

# greift auf Dockerfile zu
docker_build:
  stage: docker_build
  services:
    - docker:dind
  script:
    - docker login -u gitlab-ci-token -p $CI_JOB_TOKEN registry.gitlab.com
    - 'mvn clean install -Dmaven.repo.local=.m2/repository --batch-mode --errors --fail-at-end --show-version'
#    - docker cp build-cont:/usr/src/icm-analytics/target/icm-analytics.war ./target/icm-analytics.war
    - docker build --pull -t registry.gitlab.com/tum.icm/icm-analytics:latest .
    - docker push registry.gitlab.com/tum.icm/icm-analytics:latest
